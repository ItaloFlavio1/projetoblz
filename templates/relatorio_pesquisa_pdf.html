<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Relatório de Pesquisa</title>
    <meta charset="utf-8">
    <style>
        :root {
            --cor-laranja-blz: #f15a24;
            --cor-texto-principal: #212529;
            --cor-texto-secundario: #6c757d;
            --cor-fundo: #f8f9fa;
            --cor-borda: #dee2e6;
            --cor-sucesso: #28a745;
            --cor-perigo: #dc3545;
            --cor-aviso: #ffc107;
        }
        @page { size: A4; margin: 1.5cm; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; font-size: 9pt; color: var(--cor-texto-principal); }
        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--cor-laranja-blz);
            padding-bottom: 15px;
        }
        .logo { max-height: 50px; }
        .header-title h1 {
            margin: 0;
            font-size: 1.8em;
            color: var(--cor-texto-principal);
        }
        .header-title h2 {
            margin: 0;
            font-size: 1.1em;
            font-weight: 400;
            color: var(--cor-texto-secundario);
        }
        .footer { text-align: center; margin-top: 20px; font-size: 8pt; color: var(--cor-texto-secundario); position: fixed; bottom: -40px; width: 100%;}
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid var(--cor-borda); padding: 8px; text-align: left; word-break: break-word; }
        th {
            background-color: var(--cor-fundo);
            text-transform: uppercase;
            font-size: 0.8em;
        }
        tbody tr:nth-child(even) { background-color: var(--cor-fundo); }
        
        .status-badge {
            display: inline-block;
            padding: 3px 7px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }
        .status-aprovado { background-color: rgba(40, 167, 69, 0.1); color: var(--cor-sucesso); }
        .status-reprovado { background-color: rgba(220, 53, 69, 0.1); color: var(--cor-perigo); }
        .status-aguardando { background-color: rgba(255, 193, 7, 0.1); color: var(--cor-aviso); }
    </style>
</head>
<body>
    <header class="header">
        {% if logo_base64 %}
            <img src="data:image/png;base64,{{ logo_base64 }}" alt="Logotipo" class="logo">
        {% endif %}
        <div class="header-title">
            <h1>Relatório de Pesquisa</h1>
            <h2>Controle de Equipamentos Resetados</h2>
        </div>
    </header>

    <main>
        <table>
            <thead>
                <tr>
                    <th>MAC</th>
                    <th>Tipo/Modelo</th>
                    <th>Status Atual</th>
                    <th>Nº de Testes</th>
                    <th>Último Teste por</th>
                    <th>Data do Último Teste</th> <!-- NOVA COLUNA -->
                </tr>
            </thead>
            <tbody>
                {% for eq in equipamentos %}
                <tr>
                    <td>{{ eq.serial }}</td>
                    <td>{{ eq.tipo }} / {{ eq.modelo }}</td>
                    <td>
                        <span class="status-badge status-{{ eq.status_atual.split(' ')[0].lower() }}">
                            {{ eq.status_atual }}
                        </span>
                    </td>
                    <td>{{ eq.testes|length }}</td>
                    <td>{{ eq.testes[0].tester.username if eq.testes else 'N/A' }}</td>
                    <!-- EXIBE A DATA E HORA DO ÚLTIMO TESTE -->
                    <td>{{ eq.testes[0].data_teste.strftime('%d/%m/%Y %H:%M') if eq.testes else 'N/A' }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" style="text-align: center;">Nenhum resultado encontrado para os filtros aplicados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </main>
    
    <footer class="footer">
        Relatório gerado em {{ now.strftime('%d/%m/%Y às %H:%M:%S') }}
    </footer>
</body>
</html>

